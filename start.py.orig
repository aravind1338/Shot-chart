from flask import Flask, render_template, request, redirect
from data import populate_chart, getPlayerImage

app = Flask(__name__)
<<<<<<< HEAD
base_url = "http://127.0.0.1:5000"
# Hoemepage, search for a single player or navigate to comparison page
=======

# Homepage, search for a single player
>>>>>>> fix-html-spacing
@app.route('/', methods=["GET", "POST"])
def player_search():

    if request.method == "POST":
<<<<<<< HEAD
        
        # If the user wants to compare two players
        if request.form["go"] == "compare_players":
            return "<h1> Hello </h1>"
=======
>>>>>>> fix-html-spacing

        player = ""
        season = ""
        maptype = ""

        player = request.form["player"].strip()
        season = request.form["season"].strip()
        
        try:
            maptype = request.form["map_type"]
        except:
            return redirect("/error")


        if maptype == "heatmap":
            try:
                filter_paint_shots = request.form["filter"]
            except:
<<<<<<< HEAD
                return redirect("%s/error" %base_url)


            if maptype == "heatmap":
                try:
                    filter_paint_shots = request.form["filter"]
                except:
                    return redirect("%s/error" %base_url)
            else:
                filter_paint_shots = "no"


            if (player != "" and season != "" and maptype != ""):
                return redirect("%s/%s/%s/%s/%s" %(base_url, player, season, maptype, filter_paint_shots))
            else:
                # If invalid strings are input, redirect to a standard error page
                return redirect("%s/error" %base_url)
=======
                return redirect("/error")
        else:
            filter_paint_shots = "no"


        if (player != "" and season != "" and maptype != ""):
            return redirect("/%s/%s/%s/%s" %(player, season, maptype, filter_paint_shots))
        else:
            # If invalid strings are input, redirect to a standard error page
            return redirect("/error")
>>>>>>> fix-html-spacing

    else:

        return render_template('player_search.html')



# URL at which the heatmap/shotchart shows up for a single player
@app.route('/<playerName>/<seasonName>/<maptype>/<filter_paint_shots>')
def playerName(playerName, seasonName, maptype, filter_paint_shots):

    bball_court = populate_chart(playerName, seasonName, maptype, filter_paint_shots)

    player_img = getPlayerImage(playerName)

    return render_template('graphs.html', graph1=bball_court, image=player_img, player=playerName, season=seasonName)


<<<<<<< HEAD
=======
# URL where you can look at two players side by side
@app.route('/compare', methods=["GET", "POST"])
def compare():

    if request.method == "POST":
        
        p1 = ""
        s1 = ""
        p2 = ""
        s2 = ""

        p1 = request.form["p1"].strip()
        s1 = request.form["s1"].strip()
        p2 = request.form["p2"].strip()
        s2 = request.form["s2"].strip()
        
        try:
            maptype = request.form["map_type"]
        except:
            return redirect("/error")


        if maptype == "heatmap":
            try:
                filter_paint_shots = request.form["filter"]
            except:
                return redirect("/error")
        else:
            filter_paint_shots = "no"


        if (p1 != "" and p2 != "" and s1 != "" and s2 != "" and maptype != ""):
            return redirect("/compare/%s/%s/%s/%s/%s/%s" %(p1, s1, p2, s2, maptype, filter_paint_shots))
        else:
            # If invalid strings are input, redirect to a standard error page
            return redirect("/error")

    else:

        return render_template("player_compare.html")


@app.route('/compare/<p1>/<s1>/<p2>/<s2>/<maptype>/<filter_paint_shots>')
def multiPlayerData(p1, s1, p2, s2, maptype, filter_paint_shots):

    p1_data = populate_chart(p1, s1, maptype, filter_paint_shots)
    p2_data = populate_chart(p2, s2, maptype, filter_paint_shots)

    p1_img = getPlayerImage(p1)
    p2_img = getPlayerImage(p2)

    return render_template('player_compare_graphs.html', graph1=p1_data, graph2= p2_data, p1_img=p1_img, p2_img=p2_img, p1=p1, s1=s1, p2=p2, s2=s2)


>>>>>>> fix-html-spacing
@app.route('/error')
def error():
    return "<h1> Error! Check your player name and the format of the season and the map type</h1>"

if __name__ == '__main__':
   app.run(debug = True)